From e4aae7077085a3e456de8ef67fd4c4a83e26bd58 Mon Sep 17 00:00:00 2001
From: Joachim Breitner <mail@joachim-breitner.de>
Date: Fri, 4 Jun 2010 12:45:57 +0200
Subject: Use 172.0.1.1

---
 doc/README.html.in |   21 ++++++++++-----------
 nss-myhostname.c   |    4 +++-
 2 files changed, 13 insertions(+), 12 deletions(-)

diff --git a/doc/README.html.in b/doc/README.html.in
index f786182..16bb99c 100644
--- a/doc/README.html.in
+++ b/doc/README.html.in
@@ -62,14 +62,13 @@ released. Initial release.</p>
 <p><tt>nss-myhostname</tt> is a plugin for the GNU Name Service Switch
 (NSS) functionality of the GNU C Library (<tt>glibc</tt>) providing
 host name resolution for the locally configured system hostname as
-returned by <tt>gethostname(2)</tt>. Various software relies on an
-always resolvable local host name. When using dynamic hostnames this
-is usually achieved by patching <tt>/etc/hosts</tt> at the same time
-as changing the host name. This however is not ideal since it requires
-a writable <tt>/etc</tt> file system and is fragile because the file
-might be edited by the administrator at the same
-time. <tt>nss-myhostname</tt> simply returns all locally configure
-public IP addresses, or -- if none are configured -- the IPv4
+returned by <tt>gethostname(2)</tt>. A lot of software relies on that the
+local host name is resolvable via DNS to an IPv4 or IPv6 address. When
+using dynamic hostnames this is usually achieved by
+patching <tt>/etc/hosts</tt> which however is suboptimal since it
+requires a writable <tt>/etc</tt> file system and is fragile because
+the file might also be edited by the
+administrator. <tt>nss-myhostname</tt> simply returns the IPv4
 address <tt>127.0.0.2</tt> (wich is on the local loopback) and the
 IPv6 address <tt>::1</tt> (which is the local host) for whatever
 system hostname is configured locally. Patching <tt>/etc/hosts</tt>
@@ -116,9 +115,9 @@ use <tt>glibc</tt>'s <tt>getent</tt> tool:
 ::1             STREAM omega
 ::1             DGRAM
 ::1             RAW
-127.0.0.2       STREAM
-127.0.0.2       DGRAM
-127.0.0.2       RAW
+127.0.1.1       STREAM
+127.0.1.1       DGRAM
+127.0.1.1       RAW
 </pre>
 
 <p>In this case the local host name is <i>omega</i>.</p>
diff --git a/nss-myhostname.c b/nss-myhostname.c
index 293166c..5a7aa80 100644
--- a/nss-myhostname.c
+++ b/nss-myhostname.c
@@ -39,7 +39,9 @@
  * IPv6 we use ::1 which unfortunately will not translate back to the
  * hostname but instead something like "localhost6" or so. */
 
-#define LOCALADDRESS_IPV4 (htonl(0x7F000002))
+/* DEBIAN: Default /etc/hosts uses 172.0.1.1, so that is what we use as well */
+
+#define LOCALADDRESS_IPV4 (htonl(0x7F000101))
 #define LOCALADDRESS_IPV6 &in6addr_loopback
 #define LOOPBACK_INTERFACE "lo"
 
-- 
1.7.5.3

